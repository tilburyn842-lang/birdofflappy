<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bird of Flappy</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            overflow: hidden;
            background: #000;
            font-family: 'Courier New', monospace;
        }
        
        @font-face {
            font-family: 'PixelFont';
            src: local('Courier New'), local('monospace');
        }
        
        * {
            font-family: 'PixelFont', 'Courier New', monospace !important;
        }
        
        #gameCanvas {
            display: block;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
        
        #score {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 48px;
            color: white;
            z-index: 10;
            font-weight: bold;
            text-align: center;
            text-shadow: 0 0 10px #FFD700;
        }
        
        #coins {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 10;
        }
        
        .coins-display {
            display: flex;
            align-items: center;
            background: linear-gradient(135deg, #2c2c2c, #1a1a1a);
            border: 3px solid #FFD700;
            border-radius: 10px;
            padding: 8px 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.6);
        }
        
        .coin-icon-game {
            width: 32px;
            height: 32px;
            background: radial-gradient(circle at 30% 30%, #FFD700, #FFA500);
            border-radius: 50%;
            border: 2px solid #FF8C00;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            color: #FF8C00;
        }
        
        .coin-count {
            font-size: 24px;
            font-weight: bold;
            color: #FFD700;
            margin-left: 6px;
        }
        
        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        #startScreen.active {
            opacity: 1;
            pointer-events: all;
        }
        
        #startScreen h1 {
            font-size: 60px;
            margin-bottom: 15px;
            color: #FFD700;
            letter-spacing: 5px;
            animation: bounce 2s infinite;
            text-align: center;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        
        #startScreen p {
            font-size: 20px;
            color: white;
            margin-bottom: 5px;
        }
        
        .stats-display {
            display: flex;
            gap: 30px;
            margin: 15px 0;
            font-size: 24px;
            color: white;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .button-row {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        
        .play-button {
            background: linear-gradient(135deg, #FF6B6B, #FF3838);
            color: white;
            border: 4px solid #FFD700;
            padding: 15px 60px;
            font-size: 32px;
            margin: 15px;
            cursor: pointer;
            border-radius: 15px;
            font-weight: bold;
            box-shadow: 0 10px 25px rgba(0,0,0,0.6);
            transition: all 0.3s;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .play-button:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 30px rgba(0,0,0,0.7);
        }
        
        .play-button:active {
            transform: translateY(-2px) scale(1.02);
        }
        
        .fade-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: black;
            z-index: 250;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.6s ease;
        }
        
        .fade-overlay.active {
            opacity: 1;
        }
        
        #shop, #challenges, #achievements {
            position: fixed;
            top: 0;
            right: -400px;
            width: 380px;
            height: 100vh;
            background: rgba(0,0,0,0.97);
            padding: 20px;
            overflow-y: auto;
            z-index: 200;
            transition: right 0.3s ease;
            border-left: 3px solid #5cb85c;
        }
        
        #shop.open, #challenges.open, #achievements.open {
            right: 0;
        }
        
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 150;
            display: none;
        }
        
        .menu-overlay.active {
            display: block;
        }
        
        .menu-button {
            background: linear-gradient(135deg, #4ECDC4, #44A08D);
            color: white;
            border: 3px solid #FFD700;
            padding: 15px;
            font-size: 18px;
            margin: 0;
            cursor: pointer;
            border-radius: 15px;
            font-weight: bold;
            width: 160px;
            height: 160px;
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.5);
            transition: all 0.3s;
        }
        
        .menu-button:hover {
            transform: translateY(-5px) scale(1.03);
            box-shadow: 0 12px 25px rgba(0,0,0,0.6);
            background: linear-gradient(135deg, #5EDDD4, #54B09D);
        }
        
        .menu-button:active {
            transform: translateY(-2px) scale(1.01);
        }
        
        .shop-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin: 15px 0;
        }
        
        .shop-section {
            margin: 20px 0;
        }
        
        .section-title {
            font-size: 24px;
            color: #FFD700;
            margin-bottom: 15px;
            border-bottom: 2px solid #FFD700;
            padding-bottom: 5px;
        }
        
        .item-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border: 2px solid #5cb85c;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .item-card:hover {
            background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.1));
            transform: translateX(5px);
            border-color: #FFD700;
        }
        
        .item-card.equipped {
            border-color: #FFD700;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 215, 0, 0.1));
        }
        
        .item-card.locked {
            opacity: 0.6;
        }
        
        .item-preview {
            width: 60px;
            height: 60px;
            border: 2px solid #000;
            border-radius: 8px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }
        
        .item-info {
            flex: 1;
        }
        
        .item-name {
            font-size: 18px;
            margin: 0 0 5px 0;
            color: white;
            font-weight: bold;
        }
        
        .item-description {
            font-size: 12px;
            color: #aaa;
            margin-bottom: 5px;
        }
        
        .item-price {
            font-size: 16px;
            color: #FFD700;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .back-btn {
            position: static;
            background: linear-gradient(135deg, #d9534f, #c9302c);
            border-color: #FFD700;
            padding: 10px 20px;
            font-size: 16px;
            width: 100%;
            margin-bottom: 15px;
            height: auto;
        }
        
        .hidden {
            display: none !important;
        }
        
        .shop-currency {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(255,215,0,0.1);
            border-radius: 10px;
            border: 2px solid #FFD700;
        }
        
        .shop-coin-icon {
            width: 40px;
            height: 40px;
            background: radial-gradient(circle at 30% 30%, #FFD700, #FFA500);
            border-radius: 50%;
            border: 2px solid #FF8C00;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            color: #FF8C00;
        }
        
        .shop-coin-count {
            font-size: 28px;
            font-weight: bold;
            color: #FFD700;
        }
        
        .loading {
            color: white;
            text-align: center;
            padding: 20px;
            font-size: 16px;
        }
        
        .error {
            color: #ff6b6b;
            text-align: center;
            padding: 20px;
            font-size: 16px;
        }
        
        .coin-reward {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 215, 0, 0.9);
            color: #000;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 24px;
            font-weight: bold;
            z-index: 30;
            opacity: 0;
            transition: opacity 0.3s;
            text-align: center;
            border: 3px solid #FF8C00;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }
        
        .coin-reward.show {
            opacity: 1;
            animation: rewardPulse 1s ease-out;
        }
        
        @keyframes rewardPulse {
            0% { transform: translateX(-50%) scale(0.5); opacity: 0; }
            50% { transform: translateX(-50%) scale(1.2); opacity: 1; }
            100% { transform: translateX(-50%) scale(1); opacity: 1; }
        }
        
        /* Challenge styles */
        .challenge-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        
        .challenge-card {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(76, 175, 80, 0.05));
            border: 2px solid #4CAF50;
            padding: 15px;
            border-radius: 10px;
            transition: all 0.3s;
        }
        
        .challenge-card.completed {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 215, 0, 0.1));
            border-color: #FFD700;
        }
        
        .challenge-title {
            font-size: 18px;
            margin: 0 0 8px 0;
            color: white;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .challenge-description {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 10px;
        }
        
        .challenge-reward {
            font-size: 16px;
            color: #FFD700;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .challenge-progress {
            margin-top: 8px;
            background: rgba(255,255,255,0.1);
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
        }
        
        .challenge-progress-bar {
            height: 100%;
            background: #4CAF50;
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        .challenge-progress-text {
            font-size: 12px;
            color: #aaa;
            text-align: right;
            margin-top: 2px;
        }
        
        .challenges-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #FFD700;
        }
        
        .daily-reset {
            font-size: 14px;
            color: #aaa;
            text-align: center;
            margin-top: 10px;
        }
        
        .challenge-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-right: 10px;
        }
        
        .challenge-title-content {
            display: flex;
            align-items: center;
        }
        
        /* Achievement styles */
        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .achievement-card {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(75, 0, 130, 0.05));
            border: 2px solid #8A2BE2;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s;
        }
        
        .achievement-card.completed {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 215, 0, 0.1));
            border-color: #FFD700;
        }
        
        .achievement-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .achievement-name {
            font-size: 16px;
            color: white;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .achievement-desc {
            font-size: 12px;
            color: #aaa;
            margin-bottom: 8px;
        }
        
        .achievement-reward {
            font-size: 14px;
            color: #FFD700;
            font-weight: bold;
        }
        
        /* Daily Login styles */
        .login-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin: 15px 0;
        }
        
        .login-day {
            background: rgba(255,255,255,0.1);
            border: 2px solid #5cb85c;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            position: relative;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .login-day.claimed {
            background: rgba(76, 175, 80, 0.3);
            border-color: #4CAF50;
        }
        
        .login-day.today {
            background: rgba(255, 215, 0, 0.3);
            border-color: #FFD700;
            animation: pulse 2s infinite;
        }
        
        .login-reward {
            font-size: 12px;
            color: #FFD700;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .login-streak {
            font-size: 18px;
            color: #FFD700;
            text-align: center;
            margin: 10px 0;
        }
        
        /* Voice Line Display */
        .voice-line {
            position: absolute;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 20px;
            font-weight: bold;
            z-index: 40;
            opacity: 0;
            text-align: center;
            border: 2px solid #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }
        
        .voice-line.show {
            opacity: 1;
            animation: voiceSlide 2s ease-out;
        }
        
        @keyframes voiceSlide {
            0% { transform: translateX(-50%) translateY(-20px); opacity: 0; }
            20% { transform: translateX(-50%) translateY(0); opacity: 1; }
            80% { transform: translateX(-50%) translateY(0); opacity: 1; }
            100% { transform: translateX(-50%) translateY(-20px); opacity: 0; }
        }
        
        /* Celebration Effects */
        .celebration {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }
        
        .celebration.active {
            display: block;
        }
        
        /* Particle */
        .particle {
            position: absolute;
            pointer-events: none;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="score">0</div>
    <div id="coins" class="hidden">
        <div class="coins-display">
            <div class="coin-icon-game">GU</div>
            <div class="coin-count" id="coinCount">0</div>
        </div>
    </div>
    
    <div class="coin-reward" id="coinReward">+2 GU!</div>
    <div class="voice-line" id="voiceLine">Awesome!</div>
    
    <div class="fade-overlay" id="fadeOverlay"></div>
    <div class="menu-overlay" id="menuOverlay" onclick="closeAllMenus()"></div>
    <div class="celebration" id="celebration"></div>
    
    <div id="startScreen" class="active">
        <h1>BIRD OF FLAPPY</h1>
        <p>Click or Press SPACE to Start</p>
        
        <div class="stats-display">
            <div class="stat-item">
                <span style="font-size: 24px;">üèÜ</span>
                <span>High Score: <span id="menuHighScore">0</span></span>
            </div>
            <div class="stat-item">
                <div class="coin-icon-game" style="width: 30px; height: 30px; font-size: 12px;">GU</div>
                <span><span id="menuCoins">0</span> GU</span>
            </div>
        </div>
        
        <button class="play-button" onclick="startGameFromMenu()">‚ñ∂ PLAY</button>
        
        <div class="button-row">
            <button class="menu-button" onclick="toggleShop()">
                <span style="font-size: 48px;">üõí</span>
                <span>SHOP</span>
            </button>
            <button class="menu-button" onclick="toggleAchievements()">
                <span style="font-size: 48px;">üèÖ</span>
                <span>ACHIEVEMENTS</span>
            </button>
            <button class="menu-button" onclick="toggleChallenges()">
                <span style="font-size: 48px;">üéØ</span>
                <span>DAILY</span>
            </button>
        </div>
        
        <div class="login-streak" id="dailyLoginInfo">
            Daily Login Bonus Available!
        </div>
    </div>
    
    <!-- Shop Menu -->
    <div id="shop">
        <button class="menu-button back-btn" onclick="toggleShop()">‚úñ CLOSE</button>
        <h1 style="font-size: 36px; margin-bottom: 15px; color: #FFD700; text-align: center;">SKIN SHOP</h1>
        
        <div class="shop-currency">
            <div class="shop-coin-icon">GU</div>
            <div class="shop-coin-count" id="shopCoins">0 GU</div>
        </div>
        
        <div class="shop-section">
            <div class="section-title">üéÆ CHARACTER SKINS (25 Total)</div>
            <div class="shop-grid" id="skinGrid">
                <div class="loading">Loading skins...</div>
            </div>
        </div>
    </div>
    
    <!-- Challenges Menu -->
    <div id="challenges">
        <button class="menu-button back-btn" onclick="toggleChallenges()">‚úñ CLOSE</button>
        <h1 style="font-size: 36px; margin-bottom: 15px; color: #FFD700; text-align: center;">DAILY CHALLENGES</h1>
        
        <div class="challenges-header">
            <div style="font-size: 18px; color: #FFD700;">Complete challenges for rewards!</div>
        </div>
        
        <div class="daily-reset" id="dailyResetTimer">Resets in: 24h 00m</div>
        
        <div class="challenge-grid" id="challengeGrid">
            <div class="loading">Loading daily challenges...</div>
        </div>
    </div>
    
    <!-- Achievements Menu -->
    <div id="achievements">
        <button class="menu-button back-btn" onclick="toggleAchievements()">‚úñ CLOSE</button>
        <h1 style="font-size: 36px; margin-bottom: 15px; color: #FFD700; text-align: center;">ACHIEVEMENTS</h1>
        
        <div style="text-align: center; margin-bottom: 20px; color: #FFD700;">
            Complete achievements for rewards!
        </div>
        
        <div class="achievement-grid" id="achievementGrid">
            <div class="loading">Loading achievements...</div>
        </div>
    </div>
    
    <!-- Daily Login Menu -->
    <div id="dailyLogin" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.95); padding: 30px; border-radius: 15px; border: 4px solid #FFD700; z-index: 300; text-align: center; max-width: 500px; width: 90%;">
        <h1 style="color: #FFD700; margin-bottom: 20px;">üéÅ DAILY LOGIN BONUS</h1>
        <div class="login-streak">üî• Streak: <span id="currentStreak">0</span> days</div>
        
        <div class="login-calendar" id="loginCalendar"></div>
        
        <div style="margin: 20px 0;">
            <div class="coin-icon-game" style="width: 60px; height: 60px; font-size: 20px; margin: 0 auto 10px;">GU</div>
            <div style="font-size: 24px; color: #FFD700; font-weight: bold;">Today's Reward: <span id="todaysReward">50</span> GU</div>
        </div>
        
        <button class="play-button" style="font-size: 24px; padding: 10px 30px;" onclick="claimDailyReward()">CLAIM REWARD!</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score');
        const startScreen = document.getElementById('startScreen');
        const coinReward = document.getElementById('coinReward');
        const voiceLine = document.getElementById('voiceLine');
        const celebration = document.getElementById('celebration');
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            PIPE_WIDTH = canvas.width * 0.08;
            PIPE_GAP = canvas.height * 0.38;
            BASE_PIPE_SPEED = canvas.width * 0.003;
            GROUND_HEIGHT = canvas.height * 0.15;
        });
        
        // ========== SOUND SYSTEM ==========
        const soundManager = {
            enabled: true,
            audioContext: null,
            
            init() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch(e) {
                    console.log("Web Audio API not supported");
                    this.enabled = false;
                }
            },
            
            playJump() {
                if (!this.enabled) return;
                
                try {
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(400, this.audioContext.currentTime);
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(0.3, this.audioContext.currentTime + 0.01);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.1);
                    
                    oscillator.start(this.audioContext.currentTime);
                    oscillator.stop(this.audioContext.currentTime + 0.1);
                } catch(e) {}
            },
            
            playCoin() {
                if (!this.enabled) return;
                
                try {
                    const oscillator1 = this.audioContext.createOscillator();
                    const oscillator2 = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    
                    oscillator1.connect(gainNode);
                    oscillator2.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    oscillator1.frequency.setValueAtTime(1200, this.audioContext.currentTime);
                    oscillator2.frequency.setValueAtTime(800, this.audioContext.currentTime);
                    oscillator1.type = 'triangle';
                    oscillator2.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(0.4, this.audioContext.currentTime + 0.05);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.3);
                    
                    oscillator1.start(this.audioContext.currentTime);
                    oscillator2.start(this.audioContext.currentTime);
                    oscillator1.stop(this.audioContext.currentTime + 0.3);
                    oscillator2.stop(this.audioContext.currentTime + 0.3);
                } catch(e) {}
            },
            
            playDeath() {
                if (!this.enabled) return;
                
                try {
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(300, this.audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(50, this.audioContext.currentTime + 0.5);
                    oscillator.type = 'sawtooth';
                    
                    gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(0.5, this.audioContext.currentTime + 0.05);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.5);
                    
                    oscillator.start(this.audioContext.currentTime);
                    oscillator.stop(this.audioContext.currentTime + 0.5);
                } catch(e) {}
            },
            
            playAchievement() {
                if (!this.enabled) return;
                
                try {
                    const times = [0, 0.1, 0.2, 0.3, 0.4];
                    const notes = [523.25, 659.25, 783.99, 1046.50, 1318.51];
                    
                    times.forEach((time, i) => {
                        setTimeout(() => {
                            const oscillator = this.audioContext.createOscillator();
                            const gainNode = this.audioContext.createGain();
                            
                            oscillator.connect(gainNode);
                            gainNode.connect(this.audioContext.destination);
                            
                            oscillator.frequency.setValueAtTime(notes[i], this.audioContext.currentTime);
                            oscillator.type = 'triangle';
                            
                            gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                            gainNode.gain.linearRampToValueAtTime(0.3, this.audioContext.currentTime + 0.05);
                            gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.2);
                            
                            oscillator.start(this.audioContext.currentTime);
                            oscillator.stop(this.audioContext.currentTime + 0.2);
                        }, time * 1000);
                    });
                } catch(e) {}
            }
        };
        
        soundManager.init();
        
        // ========== VOICE LINES ==========
        const voiceLines = {
            achievements: [
                "Awesome!", "Great Job!", "Incredible!", "You're Amazing!",
                "New Record!", "High Score!", "Unstoppable!", "Legendary!",
                "Perfect!", "Fantastic!", "Excellent!", "Outstanding!"
            ],
            milestones: [
                "Milestone Reached!", "Keep Going!", "You're On Fire!",
                "Nothing Can Stop You!", "Flap Master!", "Pipe Legend!"
            ]
        };
        
        function playVoiceLine(type = 'achievements') {
            const lines = voiceLines[type];
            const line = lines[Math.floor(Math.random() * lines.length)];
            voiceLine.textContent = line;
            voiceLine.classList.add('show');
            
            setTimeout(() => {
                voiceLine.classList.remove('show');
            }, 2000);
        }
        
        // ========== PARTICLE SYSTEM ==========
        const particleSystem = {
            particles: [],
            
            createCoinSparkles(x, y, count = 10) {
                for (let i = 0; i < count; i++) {
                    this.particles.push({
                        x: x,
                        y: y,
                        vx: (Math.random() - 0.5) * 8,
                        vy: (Math.random() - 0.5) * 8 - 2,
                        life: 1.0,
                        color: '#FFD700',
                        size: Math.random() * 5 + 2,
                        type: 'sparkle'
                    });
                }
            },
            
            createCelebration(count = 50) {
                for (let i = 0; i < count; i++) {
                    const colors = ['#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', '#00FFFF'];
                    this.particles.push({
                        x: Math.random() * canvas.width,
                        y: canvas.height,
                        vx: (Math.random() - 0.5) * 4,
                        vy: -Math.random() * 15 - 5,
                        life: 2.0,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        size: Math.random() * 8 + 4,
                        type: 'celebration'
                    });
                }
            },
            
            update() {
                for (let i = this.particles.length - 1; i >= 0; i--) {
                    const p = this.particles[i];
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.3;
                    p.life -= 0.02;
                    
                    if (p.life <= 0) {
                        this.particles.splice(i, 1);
                    }
                }
            },
            
            draw() {
                this.particles.forEach(p => {
                    ctx.save();
                    ctx.globalAlpha = p.life;
                    ctx.fillStyle = p.color;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                });
            }
        };
        
        // ========== SAVE DATA ==========
        const saveData = {
            coins: parseInt(localStorage.getItem('flappyCoins') || '0'),
            highScore: parseInt(localStorage.getItem('flappyHighScore') || '0'),
            currentSkin: localStorage.getItem('flappySkin') || 'classic',
            unlockedSkins: JSON.parse(localStorage.getItem('flappyUnlockedSkins') || '["classic"]'),
            playerId: localStorage.getItem('flappyPlayerId') || generatePlayerId(),
            achievements: JSON.parse(localStorage.getItem('flappyAchievements') || '{}'),
            achievementsProgress: JSON.parse(localStorage.getItem('flappyAchievementsProgress') || '{}'),
            loginStreak: parseInt(localStorage.getItem('flappyLoginStreak') || '0'),
            lastLoginDate: localStorage.getItem('flappyLastLoginDate') || '',
            dailyRewardsClaimed: JSON.parse(localStorage.getItem('flappyDailyRewardsClaimed') || '[]'),
            completedChallenges: JSON.parse(localStorage.getItem('flappyCompletedChallenges') || '{}'),
            challengeProgress: JSON.parse(localStorage.getItem('flappyChallengeProgress') || '{}'),
            lastPlayDate: localStorage.getItem('flappyLastPlayDate') || '',
            dailyChallenges: JSON.parse(localStorage.getItem('flappyDailyChallenges') || 'null')
        };
        
        function generatePlayerId() {
            return 'player_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        function saveGame() {
            localStorage.setItem('flappyCoins', saveData.coins);
            localStorage.setItem('flappyHighScore', saveData.highScore);
            localStorage.setItem('flappySkin', saveData.currentSkin);
            localStorage.setItem('flappyUnlockedSkins', JSON.stringify(saveData.unlockedSkins));
            localStorage.setItem('flappyPlayerId', saveData.playerId);
            localStorage.setItem('flappyAchievements', JSON.stringify(saveData.achievements));
            localStorage.setItem('flappyAchievementsProgress', JSON.stringify(saveData.achievementsProgress));
            localStorage.setItem('flappyLoginStreak', saveData.loginStreak);
            localStorage.setItem('flappyLastLoginDate', saveData.lastLoginDate);
            localStorage.setItem('flappyDailyRewardsClaimed', JSON.stringify(saveData.dailyRewardsClaimed));
            localStorage.setItem('flappyCompletedChallenges', JSON.stringify(saveData.completedChallenges));
            localStorage.setItem('flappyChallengeProgress', JSON.stringify(saveData.challengeProgress));
            localStorage.setItem('flappyLastPlayDate', saveData.lastPlayDate);
            localStorage.setItem('flappyDailyChallenges', JSON.stringify(saveData.dailyChallenges));
        }
        
        // ========== DAILY LOGIN SYSTEM ==========
        const dailyLoginSystem = {
            rewards: [10, 20, 30, 50, 75, 100, 150],
            
            checkDailyLogin() {
                const today = new Date().toDateString();
                
                if (saveData.lastLoginDate !== today) {
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    
                    if (saveData.lastLoginDate === yesterday.toDateString()) {
                        saveData.loginStreak++;
                    } else if (saveData.lastLoginDate !== today) {
                        saveData.loginStreak = 1;
                    }
                    
                    saveData.lastLoginDate = today;
                    
                    setTimeout(() => {
                        this.showLoginBonus();
                    }, 1000);
                    
                    saveGame();
                }
                
                updateLoginDisplay();
            },
            
            showLoginBonus() {
                const loginMenu = document.getElementById('dailyLogin');
                if (loginMenu) {
                    document.getElementById('currentStreak').textContent = saveData.loginStreak;
                    
                    const todayIndex = (saveData.loginStreak - 1) % this.rewards.length;
                    const reward = this.rewards[todayIndex];
                    document.getElementById('todaysReward').textContent = reward;
                    
                    this.renderCalendar();
                    
                    loginMenu.style.display = 'block';
                }
            },
            
            claimDailyReward() {
                const todayIndex = (saveData.loginStreak - 1) % this.rewards.length;
                const reward = this.rewards[todayIndex];
                
                saveData.coins += reward;
                totalCoins = saveData.coins;
                
                const today = new Date().toDateString();
                saveData.dailyRewardsClaimed.push(today);
                
                soundManager.playAchievement();
                
                triggerCelebration(`üéÅ Daily Reward: +${reward} GU!`);
                
                document.getElementById('dailyLogin').style.display = 'none';
                
                saveGame();
                updateCoinDisplays();
            },
            
            renderCalendar() {
                const calendar = document.getElementById('loginCalendar');
                if (!calendar) return;
                
                calendar.innerHTML = '';
                
                for (let i = 0; i < 7; i++) {
                    const day = document.createElement('div');
                    day.className = 'login-day';
                    
                    const dayIndex = i;
                    const reward = this.rewards[dayIndex];
                    
                    const daysAgo = saveData.loginStreak - (7 - i);
                    if (daysAgo > 0) {
                        day.classList.add('claimed');
                    }
                    
                    if (i === 6) {
                        day.classList.add('today');
                    }
                    
                    day.innerHTML = `
                        <div>Day ${i + 1}</div>
                        <div class="login-reward">${reward} GU</div>
                    `;
                    
                    calendar.appendChild(day);
                }
            }
        };
        
        function updateLoginDisplay() {
            const today = new Date().toDateString();
            const hasClaimedToday = saveData.dailyRewardsClaimed.includes(today);
            
            document.getElementById('dailyLoginInfo').textContent = 
                hasClaimedToday ? `üî• ${saveData.loginStreak} Day Streak!` : 'üéÅ Daily Login Bonus Available!';
        }
        
        // ========== ACHIEVEMENTS SYSTEM ==========
        const achievementsSystem = {
            achievements: [
                {
                    id: 'first_flight',
                    name: 'First Flight',
                    description: 'Play your first game',
                    icon: 'üïäÔ∏è',
                    reward: 10,
                    condition: (stats) => stats.gamesPlayed >= 1,
                    type: 'stat'
                },
                {
                    id: 'score_10',
                    name: 'Getting Started',
                    description: 'Score 10 points',
                    icon: 'üéØ',
                    reward: 20,
                    condition: (stats) => stats.highScore >= 10,
                    type: 'score'
                },
                {
                    id: 'score_50',
                    name: 'Half Century',
                    description: 'Score 50 points',
                    icon: 'üèÜ',
                    reward: 50,
                    condition: (stats) => stats.highScore >= 50,
                    type: 'score'
                },
                {
                    id: 'score_100',
                    name: 'Century',
                    description: 'Score 100 points',
                    icon: 'üíØ',
                    reward: 100,
                    condition: (stats) => stats.highScore >= 100,
                    type: 'score'
                },
                {
                    id: 'rich_bird',
                    name: 'Rich Bird',
                    description: 'Collect 100 coins',
                    icon: 'üí∞',
                    reward: 50,
                    condition: (stats) => stats.totalCoins >= 100,
                    type: 'coins'
                },
                {
                    id: 'millionaire',
                    name: 'Millionaire Bird',
                    description: 'Collect 1000 coins',
                    icon: 'ü§ë',
                    reward: 500,
                    condition: (stats) => stats.totalCoins >= 1000,
                    type: 'coins'
                },
                {
                    id: 'pipe_master',
                    name: 'Pipe Master',
                    description: 'Pass 100 pipes total',
                    icon: 'üéÆ',
                    reward: 75,
                    condition: (stats) => stats.totalPipesPassed >= 100,
                    type: 'pipes'
                },
                {
                    id: 'skin_collector',
                    name: 'Skin Collector',
                    description: 'Unlock 5 skins',
                    icon: 'üé®',
                    reward: 100,
                    condition: (stats) => stats.skinsUnlocked >= 5,
                    type: 'skins'
                },
                {
                    id: 'login_7',
                    name: 'Weekly Flapper',
                    description: 'Login for 7 consecutive days',
                    icon: 'üî•',
                    reward: 150,
                    condition: (stats) => stats.loginStreak >= 7,
                    type: 'login'
                },
                {
                    id: 'legendary',
                    name: 'Legendary Bird',
                    description: 'Score 500 points',
                    icon: 'üåü',
                    reward: 500,
                    condition: (stats) => stats.highScore >= 500,
                    type: 'score'
                }
            ],
            
            checkAchievements(gameStats) {
                let newAchievements = [];
                
                this.achievements.forEach(achievement => {
                    if (!saveData.achievements[achievement.id] && achievement.condition(gameStats)) {
                        saveData.achievements[achievement.id] = true;
                        saveData.coins += achievement.reward;
                        totalCoins = saveData.coins;
                        
                        newAchievements.push(achievement);
                        
                        soundManager.playAchievement();
                        playVoiceLine('achievements');
                        triggerCelebration(`üèÜ Achievement: ${achievement.name}!`);
                    }
                });
                
                if (newAchievements.length > 0) {
                    saveGame();
                    updateCoinDisplays();
                }
                
                return newAchievements;
            },
            
            renderAchievements() {
                const grid = document.getElementById('achievementGrid');
                if (!grid) return;
                
                grid.innerHTML = '';
                
                const gameStats = {
                    gamesPlayed: saveData.achievementsProgress.gamesPlayed || 0,
                    highScore: saveData.highScore,
                    totalCoins: saveData.coins,
                    totalPipesPassed: saveData.achievementsProgress.totalPipesPassed || 0,
                    skinsUnlocked: saveData.unlockedSkins.length,
                    loginStreak: saveData.loginStreak
                };
                
                this.achievements.forEach(achievement => {
                    const card = document.createElement('div');
                    card.className = `achievement-card ${saveData.achievements[achievement.id] ? 'completed' : ''}`;
                    
                    card.innerHTML = `
                        <div class="achievement-icon">${achievement.icon}</div>
                        <div class="achievement-name">${achievement.name}</div>
                        <div class="achievement-desc">${achievement.description}</div>
                        <div class="achievement-reward">Reward: GU Coins</div>
                    `;
                    
                    grid.appendChild(card);
                });
            }
        };
        
        // ========== DAILY CHALLENGES ==========
        const dailyChallenges = {
            currentChallenges: null,
            
            generateDailyChallenges() {
                const today = new Date().toDateString();
                
                if (saveData.lastPlayDate !== today || !saveData.dailyChallenges) {
                    saveData.lastPlayDate = today;
                    
                    const challengeTypes = [
                        {
                            id: 'score_20',
                            title: 'Score 20 Points',
                            description: 'Get a score of 20 in one run',
                            icon: 'üéØ',
                            reward: 10,
                            type: 'score',
                            target: 20
                        },
                        {
                            id: 'score_50',
                            title: 'Score 50 Points',
                            description: 'Get a score of 50 in one run',
                            icon: 'üèÜ',
                            reward: 25,
                            type: 'score',
                            target: 50
                        },
                        {
                            id: 'collect_10_coins',
                            title: 'Collect 10 Coins',
                            description: 'Collect 10 coins in total today',
                            icon: 'üí∞',
                            reward: 15,
                            type: 'coins',
                            target: 10
                        },
                        {
                            id: 'play_5_games',
                            title: 'Play 5 Games',
                            description: 'Play 5 games today',
                            icon: 'üéÆ',
                            reward: 20,
                            type: 'games',
                            target: 5
                        },
                        {
                            id: 'survive_30_seconds',
                            title: 'Survive 30 Seconds',
                            description: 'Survive for 30 seconds in one game',
                            icon: '‚è±Ô∏è',
                            reward: 15,
                            type: 'time',
                            target: 30
                        }
                    ];
                    
                    const shuffled = [...challengeTypes].sort(() => 0.5 - Math.random());
                    saveData.dailyChallenges = shuffled.slice(0, 3);
                    
                    saveData.challengeProgress = {};
                    
                    saveGame();
                }
                
                this.currentChallenges = saveData.dailyChallenges;
                return this.currentChallenges;
            },
            
            updateChallengeProgress(challengeId, progress) {
                if (!saveData.challengeProgress[challengeId]) {
                    saveData.challengeProgress[challengeId] = 0;
                }
                
                saveData.challengeProgress[challengeId] = Math.max(saveData.challengeProgress[challengeId], progress);
                
                const challenge = this.currentChallenges?.find(c => c.id === challengeId);
                if (challenge && saveData.challengeProgress[challengeId] >= challenge.target) {
                    this.completeChallenge(challengeId);
                }
                
                saveGame();
            },
            
            completeChallenge(challengeId) {
                if (saveData.completedChallenges[challengeId]) return;
                
                const challenge = this.currentChallenges?.find(c => c.id === challengeId);
                if (challenge) {
                    saveData.completedChallenges[challengeId] = true;
                    saveData.coins += challenge.reward;
                    totalCoins = saveData.coins;
                    
                    soundManager.playAchievement();
                    
                    coinReward.textContent = `Challenge Complete!`;
                    coinReward.classList.add('show');
                    
                    setTimeout(() => {
                        coinReward.classList.remove('show');
                    }, 2000);
                    
                    saveGame();
                    updateCoinDisplays();
                }
            },
            
            getTimeUntilReset() {
                const now = new Date();
                const tomorrow = new Date(now);
                tomorrow.setDate(tomorrow.getDate() + 1);
                tomorrow.setHours(0, 0, 0, 0);
                
                const diff = tomorrow - now;
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                
                return `${hours}h ${minutes}m`;
            },
            
            renderChallenges() {
                const grid = document.getElementById('challengeGrid');
                if (!grid) return;
                
                const challenges = this.generateDailyChallenges();
                grid.innerHTML = '';
                
                challenges.forEach(challenge => {
                    const card = document.createElement('div');
                    card.className = `challenge-card ${saveData.completedChallenges[challenge.id] ? 'completed' : ''}`;
                    
                    const progress = saveData.challengeProgress[challenge.id] || 0;
                    const progressPercent = Math.min((progress / challenge.target) * 100, 100);
                    
                    card.innerHTML = `
                        <div class="challenge-title">
                            <div class="challenge-title-content">
                                <div class="challenge-icon">${challenge.icon}</div>
                                <div>${challenge.title}</div>
                            </div>
                            ${saveData.completedChallenges[challenge.id] ? 
                                '<span style="color: #4CAF50;">‚úì COMPLETED</span>' : 
                                ''}
                        </div>
                        <div class="challenge-description">${challenge.description}</div>
                        <div class="challenge-reward">
                            <div class="coin-icon-game" style="width: 20px; height: 20px; font-size: 10px;">GU</div>
                            <span>Reward: GU Coins</span>
                        </div>
                        ${!saveData.completedChallenges[challenge.id] ? `
                            <div class="challenge-progress">
                                <div class="challenge-progress-bar" style="width: ${progressPercent}%"></div>
                            </div>
                            <div class="challenge-progress-text">${progress}/${challenge.target}</div>
                        ` : ''}
                    `;
                    
                    grid.appendChild(card);
                });
                
                document.getElementById('dailyResetTimer').textContent = `Resets in: ${this.getTimeUntilReset()}`;
            }
        };
        
        // ========== CELEBRATION SYSTEM ==========
        function triggerCelebration(message = "CELEBRATION!") {
            coinReward.textContent = message;
            coinReward.classList.add('show');
            
            particleSystem.createCelebration(100);
            
            playVoiceLine('milestones');
            
            setTimeout(() => {
                coinReward.classList.remove('show');
            }, 3000);
        }
        
        // ========== SKINS (25 Total) ==========
        const birdSkins = [
            { id: 'classic', name: 'Classic Bird', price: 0, emoji: 'üê§', description: 'The original flappy bird', color: '#FFD700' },
            { id: 'duck', name: 'Yellow Duck', price: 10, emoji: 'ü¶Ü', description: 'Quack quack!', color: '#FFD700' },
            { id: 'pigeon', name: 'City Pigeon', price: 20, emoji: 'üïäÔ∏è', description: 'Urban flyer', color: '#A9A9A9' },
            { id: 'owl', name: 'Wise Owl', price: 30, emoji: 'ü¶â', description: 'Night vision expert', color: '#8B4513' },
            { id: 'penguin', name: 'Penguin', price: 40, emoji: 'üêß', description: 'Tuxedo flyer', color: '#000000' },
            { id: 'bat', name: 'Bat', price: 50, emoji: 'ü¶á', description: 'Fly at night', color: '#333333' },
            { id: 'bee', name: 'Bumblebee', price: 70, emoji: 'üêù', description: 'Buzzy flyer', color: '#FFD700' },
            { id: 'ufo', name: 'UFO', price: 100, emoji: 'üõ∏', description: 'Alien spacecraft', color: '#00FF00' },
            { id: 'spaceship', name: 'Spaceship', price: 150, emoji: 'üöÄ', description: 'To infinity!', color: '#4169E1' },
            { id: 'airplane', name: 'Airplane', price: 200, emoji: '‚úàÔ∏è', description: 'Commercial flight', color: '#FFFFFF' },
            { id: 'dragon', name: 'Dragon', price: 300, emoji: 'üêâ', description: 'Fire-breathing', color: '#DC143C' },
            { id: 'unicorn', name: 'Unicorn', price: 400, emoji: 'ü¶Ñ', description: 'Magical horn', color: '#FFB6C1' },
            { id: 'phoenix', name: 'Phoenix', price: 500, emoji: 'üî•', description: 'Reborn from ashes', color: '#FF4500' },
            { id: 'superman', name: 'Superman', price: 600, emoji: 'ü¶∏', description: 'Faster than plane', color: '#FF0000' },
            { id: 'ninja', name: 'Ninja', price: 700, emoji: 'ü•∑', description: 'Stealth master', color: '#000000' },
            { id: 'robot', name: 'Robot', price: 800, emoji: 'ü§ñ', description: 'Mechanical marvel', color: '#808080' },
            { id: 'rainbow', name: 'Rainbow Bird', price: 1500, emoji: 'üåà', description: 'Color changing', color: 'rainbow' },
            { id: 'galaxy', name: 'Galaxy Bird', price: 1000, emoji: 'üåå', description: 'Cosmic traveler', color: '#4A00E0' },
            { id: 'gold', name: 'Golden Eagle', price: 2000, emoji: 'ü•á', description: 'Solid gold', color: '#FFD700' },
            { id: 'diamond', name: 'Diamond Bird', price: 5000, emoji: 'üíé', description: 'Sparkling gem', color: '#B9F2FF' },
            { id: 'king', name: 'King', price: 10000, emoji: 'üëë', description: 'Royal ruler', color: '#FFD700' },
            { id: 'ghost', name: 'Ghost', price: 750, emoji: 'üëª', description: 'Boo!', color: '#FFFFFF' },
            { id: 'zombie', name: 'Zombie Bird', price: 850, emoji: 'üßü', description: 'Undead flyer', color: '#7CFC00' },
            { id: 'vampire', name: 'Vampire Bat', price: 900, emoji: 'ü¶á', description: 'Bloodthirsty', color: '#8B0000' },
            { id: 'angel', name: 'Angel Bird', price: 1200, emoji: 'üëº', description: 'Heavenly flyer', color: '#FFFFFF' }
        ];
        
        // ========== GAME VARIABLES ==========
        let bird = {
            x: canvas.width * 0.15,
            y: canvas.height / 2,
            width: 40,
            height: 28,
            velocity: 0,
            gravity: 0.5,
            jump: -9,
            rotation: 0,
            horizontalMotion: 0
        };
        
        let pipes = [];
        let clouds = [];
        let score = 0;
        let coinsThisRound = 0;
        let totalCoins = saveData.coins;
        let gameStarted = false;
        let gameOver = false;
        let frame = 0;
        let groundX = 0;
        let gameActive = false;
        
        let difficulty = 1;
        let gamesPlayedToday = 0;
        let gameStartTime = 0;
        let totalPipesPassed = 0;
        
        // PIPE CONFIGURATION
        let PIPE_WIDTH = canvas.width * 0.08;
        let PIPE_GAP = canvas.height * 0.38;
        let BASE_PIPE_SPEED = canvas.width * 0.003;
        let GROUND_HEIGHT = canvas.height * 0.15;
        
        // Coin reward milestones
        const coinMilestones = [
            { score: 10, coins: 2, message: "+2 GU!" },
            { score: 25, coins: 5, message: "+5 GU!" },
            { score: 50, coins: 10, message: "+10 GU!" },
            { score: 100, coins: 50, message: "+50 GU!" },
            { score: 250, coins: 100, message: "+100 GU!" },
            { score: 500, coins: 250, message: "+250 GU! INSANE!" }
        ];
        let reachedMilestones = new Set();
        
        // Initialize clouds
        for (let i = 0; i < 6; i++) {
            clouds.push({
                x: Math.random() * canvas.width,
                y: Math.random() * (canvas.height * 0.4),
                width: 60 + Math.random() * 40,
                speed: 0.3 + Math.random() * 0.5
            });
        }
        
        // Draw character
        function drawCharacter() {
            if (!gameStarted) return;
            
            ctx.save();
            
            const oscillation = Math.sin(frame * 0.1) * 3;
            ctx.translate(bird.x + bird.width / 2 + oscillation, bird.y + bird.height / 2);
            ctx.rotate(bird.rotation * Math.PI / 180);
            
            const skin = birdSkins.find(s => s.id === saveData.currentSkin) || birdSkins[0];
            
            // Get color
            let bodyColor, wingColor;
            
            if (skin.color === 'rainbow') {
                const hue = (frame * 3) % 360;
                bodyColor = `hsl(${hue}, 100%, 50%)`;
                wingColor = `hsl(${(hue + 180) % 360}, 100%, 50%)`;
            } else {
                bodyColor = skin.color;
                wingColor = skin.color;
            }
            
            // Body
            ctx.fillStyle = bodyColor;
            ctx.fillRect(-20, -14, 40, 28);
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 2;
            ctx.strokeRect(-20, -14, 40, 28);
            
            // Beak
            ctx.fillStyle = '#FF6600';
            ctx.beginPath();
            ctx.moveTo(20, -3);
            ctx.lineTo(32, 0);
            ctx.lineTo(20, 3);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // Eye
            ctx.fillStyle = '#fff';
            ctx.fillRect(8, -10, 10, 10);
            ctx.fillStyle = '#000';
            ctx.fillRect(12, -8, 5, 6);
            
            // Wing
            ctx.fillStyle = wingColor;
            ctx.fillRect(-10, 5, 20, 10);
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 2;
            ctx.strokeRect(-10, 5, 20, 10);
            
            ctx.restore();
        }
        
        function drawPipe(pipe) {
            ctx.fillStyle = pipe.moving ? '#8A2BE2' : '#5cb85c';
            ctx.fillRect(pipe.x, 0, PIPE_WIDTH, pipe.top);
            
            ctx.fillStyle = pipe.moving ? '#9370DB' : '#7ed17e';
            ctx.fillRect(pipe.x + 5, 0, 8, pipe.top);
            
            ctx.fillStyle = pipe.moving ? '#4B0082' : '#2e7d32';
            ctx.fillRect(pipe.x + PIPE_WIDTH - 8, 0, 8, pipe.top);
            
            const capHeight = 30;
            ctx.fillStyle = pipe.moving ? '#8A2BE2' : '#5cb85c';
            ctx.fillRect(pipe.x - 5, pipe.top - capHeight, PIPE_WIDTH + 10, capHeight);
            ctx.fillStyle = pipe.moving ? '#9370DB' : '#7ed17e';
            ctx.fillRect(pipe.x, pipe.top - capHeight, 8, capHeight);
            ctx.fillStyle = pipe.moving ? '#4B0082' : '#2e7d32';
            ctx.fillRect(pipe.x + PIPE_WIDTH - 3, pipe.top - capHeight, 8, capHeight);
            
            ctx.fillStyle = pipe.moving ? '#8A2BE2' : '#5cb85c';
            ctx.fillRect(pipe.x, pipe.bottom, PIPE_WIDTH, canvas.height - pipe.bottom);
            
            ctx.fillStyle = pipe.moving ? '#9370DB' : '#7ed17e';
            ctx.fillRect(pipe.x + 5, pipe.bottom, 8, canvas.height - pipe.bottom);
            
            ctx.fillStyle = pipe.moving ? '#4B0082' : '#2e7d32';
            ctx.fillRect(pipe.x + PIPE_WIDTH - 8, pipe.bottom, 8, canvas.height - pipe.bottom);
            
            ctx.fillStyle = pipe.moving ? '#8A2BE2' : '#5cb85c';
            ctx.fillRect(pipe.x - 5, pipe.bottom, PIPE_WIDTH + 10, capHeight);
            ctx.fillStyle = pipe.moving ? '#9370DB' : '#7ed17e';
            ctx.fillRect(pipe.x, pipe.bottom, 8, capHeight);
            ctx.fillStyle = pipe.moving ? '#4B0082' : '#2e7d32';
            ctx.fillRect(pipe.x + PIPE_WIDTH - 3, pipe.bottom, 8, capHeight);
        }
        
        function drawClouds() {
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            clouds.forEach(cloud => {
                ctx.fillRect(cloud.x, cloud.y, cloud.width, 25);
                ctx.fillRect(cloud.x + 10, cloud.y - 15, cloud.width - 20, 20);
                ctx.fillRect(cloud.x + 20, cloud.y - 25, cloud.width - 40, 20);
                
                cloud.x -= cloud.speed * difficulty;
                if (cloud.x + cloud.width < 0) {
                    cloud.x = canvas.width;
                    cloud.y = Math.random() * (canvas.height * 0.4);
                }
            });
        }
        
        function drawGround() {
            const groundY = canvas.height - GROUND_HEIGHT;
            
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(0, groundY, canvas.width, GROUND_HEIGHT);
            
            ctx.fillStyle = '#654321';
            for (let x = 0; x < canvas.width; x += 20) {
                for (let y = groundY + 30; y < canvas.height; y += 20) {
                    ctx.fillRect(x + (groundX % 20), y, 10, 10);
                }
            }
            
            // Grass
            ctx.fillStyle = '#7EC850';
            for (let x = -20; x < canvas.width + 20; x += 10) {
                const offsetX = (x + groundX) % canvas.width;
                if (offsetX < 0) continue;
                ctx.fillRect(offsetX, groundY, 10, 5);
            }
            
            ctx.fillStyle = '#5EAA30';
            for (let x = -20; x < canvas.width + 20; x += 15) {
                const offsetX = (x + groundX) % canvas.width;
                if (offsetX < 0) continue;
                ctx.fillRect(offsetX, groundY, 8, 15);
                ctx.fillRect(offsetX + 3, groundY + 15, 8, 15);
            }
            
            ctx.fillStyle = '#9EE86F';
            for (let x = -15; x < canvas.width + 15; x += 15) {
                const offsetX = (x + groundX) % canvas.width;
                if (offsetX < 0) continue;
                ctx.fillRect(offsetX, groundY + 5, 4, 10);
            }
            
            if (gameStarted && gameActive && !gameOver) {
                groundX -= BASE_PIPE_SPEED * difficulty;
                if (groundX <= -canvas.width) groundX = 0;
            }
        }
        
        function createPipe() {
            const minTop = canvas.height * 0.15;
            const maxTop = canvas.height - GROUND_HEIGHT - PIPE_GAP - 100;
            const top = Math.random() * (maxTop - minTop) + minTop;
            
            pipes.push({
                x: canvas.width,
                top: top,
                bottom: top + PIPE_GAP,
                scored: false,
                moving: Math.random() < 0.3,
                moveDirection: Math.random() > 0.5 ? 1 : -1,
                moveSpeed: 0.5 + Math.random() * 1,
                originalTop: top
            });
        }
        
        function update() {
            if (!gameStarted || !gameActive || gameOver) return;
            
            frame++;
            
            // Update particle system
            particleSystem.update();
            
            // Check coin milestones
            checkCoinMilestones();
            
            // Update challenge progress
            updateChallengeProgress();
            
            difficulty = 1 + (Math.floor(score / 5) * 0.15);
            
            bird.velocity += bird.gravity;
            bird.y += bird.velocity;
            
            bird.horizontalMotion = Math.sin(frame * 0.08) * 2;
            
            if (bird.velocity < 0) {
                bird.rotation = Math.max(-25, bird.velocity * 3);
            } else {
                bird.rotation = Math.min(90, bird.velocity * 2);
            }
            
            if (bird.y + bird.height >= canvas.height - GROUND_HEIGHT) {
                triggerDeath();
                return;
            }
            if (bird.y <= 0) {
                bird.y = 0;
            }
            
            pipes.forEach((pipe) => {
                // Update moving pipes
                if (pipe.moving) {
                    pipe.top += pipe.moveSpeed * pipe.moveDirection;
                    pipe.bottom = pipe.top + PIPE_GAP;
                    
                    // Bounce at boundaries
                    if (pipe.top <= canvas.height * 0.1 || pipe.top >= canvas.height - GROUND_HEIGHT - PIPE_GAP - 50) {
                        pipe.moveDirection *= -1;
                    }
                }
                
                pipe.x -= BASE_PIPE_SPEED * difficulty;
                
                if (!pipe.scored && pipe.x + PIPE_WIDTH < bird.x) {
                    pipe.scored = true;
                    score++;
                    coinsThisRound++;
                    totalCoins++;
                    totalPipesPassed++;
                    
                    // Play score sound
                    soundManager.playCoin();
                    
                    // Create coin sparkles
                    particleSystem.createCoinSparkles(bird.x, bird.y);
                    
                    scoreDisplay.textContent = score;
                    document.getElementById('coinCount').textContent = totalCoins;
                }
                
                if (bird.x + bird.horizontalMotion < pipe.x + PIPE_WIDTH && 
                    bird.x + bird.horizontalMotion + bird.width > pipe.x && 
                    (bird.y < pipe.top || bird.y + bird.height > pipe.bottom)) {
                    triggerDeath();
                    return;
                }
            });
            
            pipes = pipes.filter(pipe => pipe.x > -PIPE_WIDTH);
            
            // Pipe spawning
            let pipeSpawnRate = Math.max(60, 120 - Math.floor(score / 5) * 10);
            
            if (frame % pipeSpawnRate === 0) {
                createPipe();
            }
        }
        
        function checkCoinMilestones() {
            for (const milestone of coinMilestones) {
                if (score >= milestone.score && !reachedMilestones.has(milestone.score)) {
                    reachedMilestones.add(milestone.score);
                    
                    // Add coins
                    totalCoins += milestone.coins;
                    saveData.coins = totalCoins;
                    
                    // Play coin sound
                    soundManager.playCoin();
                    
                    // Show celebration for big milestones
                    if (milestone.coins >= 50) {
                        triggerCelebration(milestone.message);
                    } else {
                        // Show reward message
                        coinReward.textContent = milestone.message;
                        coinReward.classList.add('show');
                        
                        setTimeout(() => {
                            coinReward.classList.remove('show');
                        }, 2000);
                    }
                    
                    // Update coin display
                    document.getElementById('coinCount').textContent = totalCoins;
                    
                    break;
                }
            }
        }
        
        function updateChallengeProgress() {
            // Update score challenge
            dailyChallenges.updateChallengeProgress('score_20', score);
            dailyChallenges.updateChallengeProgress('score_50', score);
            
            // Update coins challenge
            dailyChallenges.updateChallengeProgress('collect_10_coins', coinsThisRound);
            
            // Update time challenge
            const currentTime = Date.now();
            const secondsPlayed = Math.floor((currentTime - gameStartTime) / 1000);
            dailyChallenges.updateChallengeProgress('survive_30_seconds', secondsPlayed);
        }
        
        function draw() {
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#4EC0CA');
            gradient.addColorStop(0.7, '#7DD0D8');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            drawClouds();
            
            if (gameStarted) {
                pipes.forEach(drawPipe);
                drawCharacter();
            }
            
            drawGround();
            
            // Draw particles
            particleSystem.draw();
        }
        
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        function flap() {
            if (!gameStarted) return;
            
            if (!gameActive) {
                return;
            }
            
            if (gameOver) {
                resetGame();
                return;
            }
            
            bird.velocity = bird.jump;
            soundManager.playJump();
        }
        
        function startWaitTimer() {
            setTimeout(() => {
                gameActive = true;
                gameStartTime = Date.now();
                gamesPlayedToday++;
                dailyChallenges.updateChallengeProgress('play_5_games', gamesPlayedToday);
                
                // Update achievement progress
                if (!saveData.achievementsProgress.gamesPlayed) {
                    saveData.achievementsProgress.gamesPlayed = 0;
                }
                saveData.achievementsProgress.gamesPlayed++;
                saveData.achievementsProgress.totalPipesPassed = totalPipesPassed;
                
                // Check achievements
                const gameStats = {
                    gamesPlayed: saveData.achievementsProgress.gamesPlayed,
                    highScore: saveData.highScore,
                    totalCoins: saveData.coins,
                    totalPipesPassed: totalPipesPassed,
                    skinsUnlocked: saveData.unlockedSkins.length,
                    loginStreak: saveData.loginStreak
                };
                achievementsSystem.checkAchievements(gameStats);
            }, 2000);
        }
        
        async function triggerDeath() {
            if (gameOver) return;
            
            gameOver = true;
            soundManager.playDeath();
            
            const fadeOverlay = document.getElementById('fadeOverlay');
            fadeOverlay.classList.add('active');
            
            saveData.coins = totalCoins;
            
            if (score > saveData.highScore) {
                saveData.highScore = score;
                
                // Play voice line for new record
                playVoiceLine('achievements');
                
                // Show celebration for high score
                if (score >= 50) {
                    triggerCelebration(`üéâ NEW HIGH SCORE: ${score}!`);
                }
            }
            
            // Check achievements
            const gameStats = {
                highScore: saveData.highScore,
                totalCoins: saveData.coins,
                totalPipesPassed: totalPipesPassed,
                skinsUnlocked: saveData.unlockedSkins.length,
                loginStreak: saveData.loginStreak
            };
            achievementsSystem.checkAchievements(gameStats);
            
            saveGame();
            
            setTimeout(() => {
                resetGame();
                startScreen.classList.add('active');
                document.getElementById('score').classList.add('hidden');
                document.getElementById('coins').classList.add('hidden');
                updateCoinDisplays();
                updateLoginDisplay();
                
                setTimeout(() => {
                    fadeOverlay.classList.remove('active');
                }, 100);
            }, 600);
        }
        
        function resetGame() {
            bird.y = canvas.height / 2;
            bird.velocity = 0;
            bird.rotation = 0;
            bird.horizontalMotion = 0;
            pipes = [];
            score = 0;
            coinsThisRound = 0;
            gameStarted = false;
            gameActive = false;
            gameOver = false;
            frame = 0;
            groundX = 0;
            difficulty = 1;
            
            reachedMilestones.clear();
            particleSystem.particles = [];
            
            coinReward.classList.remove('show');
            voiceLine.classList.remove('show');
            
            scoreDisplay.textContent = '0';
        }
        
        function startGameFromMenu() {
            startScreen.classList.remove('active');
            closeAllMenus();
            
            setTimeout(() => {
                gameStarted = true;
                document.getElementById('score').classList.remove('hidden');
                document.getElementById('coins').classList.remove('hidden');
                document.getElementById('coinCount').textContent = totalCoins;
                pipes = [];
                createPipe();
                startWaitTimer();
            }, 100);
        }
        
        // ========== MENU FUNCTIONS ==========
        function toggleShop() {
            const shop = document.getElementById('shop');
            const overlay = document.getElementById('menuOverlay');
            const isOpen = shop.classList.contains('open');
            
            if (isOpen) {
                shop.classList.remove('open');
                overlay.classList.remove('active');
            } else {
                closeAllMenus();
                shop.classList.add('open');
                overlay.classList.add('active');
                renderShop();
            }
        }
        
        function toggleChallenges() {
            const challenges = document.getElementById('challenges');
            const overlay = document.getElementById('menuOverlay');
            const isOpen = challenges.classList.contains('open');
            
            if (isOpen) {
                challenges.classList.remove('open');
                overlay.classList.remove('active');
            } else {
                closeAllMenus();
                challenges.classList.add('open');
                overlay.classList.add('active');
                dailyChallenges.renderChallenges();
            }
        }
        
        function toggleAchievements() {
            const achievements = document.getElementById('achievements');
            const overlay = document.getElementById('menuOverlay');
            const isOpen = achievements.classList.contains('open');
            
            if (isOpen) {
                achievements.classList.remove('open');
                overlay.classList.remove('active');
            } else {
                closeAllMenus();
                achievements.classList.add('open');
                overlay.classList.add('active');
                achievementsSystem.renderAchievements();
            }
        }
        
        function closeAllMenus() {
            document.getElementById('shop').classList.remove('open');
            document.getElementById('challenges').classList.remove('open');
            document.getElementById('achievements').classList.remove('open');
            document.getElementById('menuOverlay').classList.remove('active');
        }
        
        function renderShop() {
            const skinGrid = document.getElementById('skinGrid');
            skinGrid.innerHTML = '';
            
            const sortedSkins = [...birdSkins].sort((a, b) => a.price - b.price);
            
            sortedSkins.forEach(skin => {
                const card = createShopItem(skin, 'skin');
                skinGrid.appendChild(card);
            });
            
            updateCoinDisplays();
        }
        
        function createShopItem(item, type) {
            const card = document.createElement('div');
            card.className = 'item-card';
            
            let isUnlocked = saveData.unlockedSkins.includes(item.id);
            let isEquipped = saveData.currentSkin === item.id;
            
            if (isEquipped) card.classList.add('equipped');
            if (!isUnlocked && item.price > 0) card.classList.add('locked');
            
            const preview = document.createElement('div');
            preview.className = 'item-preview';
            preview.textContent = item.emoji;
            
            if (item.color === 'rainbow') {
                preview.style.background = 'linear-gradient(90deg, red, orange, yellow, green, blue, purple)';
            } else {
                preview.style.background = item.color;
            }
            
            const info = document.createElement('div');
            info.className = 'item-info';
            
            const name = document.createElement('div');
            name.className = 'item-name';
            name.textContent = `${item.emoji} ${item.name}`;
            
            const desc = document.createElement('div');
            desc.className = 'item-description';
            desc.textContent = item.description;
            
            const price = document.createElement('div');
            price.className = 'item-price';
            
            if (isUnlocked || item.price === 0) {
                if (isEquipped) {
                    price.textContent = '‚úì EQUIPPED';
                    price.style.color = '#44FF44';
                } else if (item.price === 0) {
                    price.textContent = 'FREE';
                    price.style.color = '#4EC0CA';
                    card.onclick = () => equipItem(item.id, type);
                } else {
                    price.textContent = 'EQUIP';
                    price.style.color = '#4EC0CA';
                    card.onclick = () => equipItem(item.id, type);
                }
            } else {
                const coinIcon = document.createElement('div');
                coinIcon.className = 'shop-coin-icon';
                coinIcon.style.width = '20px';
                coinIcon.style.height = '20px';
                coinIcon.style.fontSize = '14px';
                coinIcon.textContent = 'GU';
                price.appendChild(coinIcon);
                price.appendChild(document.createTextNode(' ' + item.price + ' GU'));
                card.onclick = () => buyItem(item, type);
            }
            
            info.appendChild(name);
            info.appendChild(desc);
            info.appendChild(price);
            card.appendChild(preview);
            card.appendChild(info);
            
            return card;
        }
        
        function buyItem(item, type) {
            if (saveData.coins >= item.price) {
                saveData.coins -= item.price;
                totalCoins = saveData.coins;
                saveData.unlockedSkins.push(item.id);
                saveData.currentSkin = item.id;
                
                soundManager.playCoin();
                
                saveGame();
                renderShop();
                updateCoinDisplays();
                
                // Check skin collector achievement
                const gameStats = {
                    skinsUnlocked: saveData.unlockedSkins.length
                };
                achievementsSystem.checkAchievements(gameStats);
            } else {
                alert(`Not enough GU coins! You need ${item.price} GU but only have ${saveData.coins} GU.`);
            }
        }
        
        function equipItem(itemId, type) {
            saveData.currentSkin = itemId;
            saveGame();
            renderShop();
        }
        
        function updateCoinDisplays() {
            document.getElementById('menuCoins').textContent = saveData.coins;
            document.getElementById('menuHighScore').textContent = saveData.highScore;
            document.getElementById('shopCoins').textContent = saveData.coins + ' GU';
        }
        
        function claimDailyReward() {
            dailyLoginSystem.claimDailyReward();
        }
        
        // ========== INITIALIZATION ==========
        canvas.addEventListener('click', flap);
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                if (!gameStarted && startScreen.classList.contains('active')) {
                    startGameFromMenu();
                } else {
                    flap();
                }
            }
        });
        
        // Initialize
        updateCoinDisplays();
        updateLoginDisplay();
        dailyLoginSystem.checkDailyLogin();
        dailyChallenges.generateDailyChallenges();
        gameLoop();
        
        // Check for achievements on load
        const initialStats = {
            gamesPlayed: saveData.achievementsProgress.gamesPlayed || 0,
            highScore: saveData.highScore,
            totalCoins: saveData.coins,
            totalPipesPassed: 0,
            skinsUnlocked: saveData.unlockedSkins.length,
            loginStreak: saveData.loginStreak
        };
        achievementsSystem.checkAchievements(initialStats);
    </script>
</body>
</html>
